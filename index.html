<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω H·ª£p ƒë·ªìng & T√†i ch√≠nh</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #51cf66 0%, #40c057 100%);
            color: white;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .data-table th, .data-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f1f3f4;
        }

        .data-table th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-active { background: #d4edda; color: #155724; }
        .status-completed { background: #cce5ff; color: #0056b3; }
        .status-pending { background: #fff3cd; color: #856404; }
        .status-cancelled { background: #f8d7da; color: #721c24; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-weight: 500;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-wrap: wrap;
            }
            
            .data-table {
                font-size: 14px;
            }
            
            .data-table th, .data-table td {
                padding: 10px 8px;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè¢ H·ªá th·ªëng Qu·∫£n l√Ω H·ª£p ƒë·ªìng & T√†i ch√≠nh</h1>
            <p>Theo d√µi h·ª£p ƒë·ªìng, doanh thu, chi ph√≠ v√† b√°o c√°o t·ªïng h·ª£p</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('contracts')">üìã H·ª£p ƒë·ªìng</button>
            <button class="nav-tab" onclick="showTab('revenue')">üí∞ Doanh thu</button>
            <button class="nav-tab" onclick="showTab('expenses')">üí∏ Chi ph√≠</button>
            <button class="nav-tab" onclick="showTab('reports')">üìä B√°o c√°o</button>
            <button class="nav-tab" onclick="showTab('dashboard')">üéØ T·ªïng quan</button>
        </div>

        <!-- Tab H·ª£p ƒë·ªìng -->
        <div id="contracts" class="tab-content active">
            <h2>üìã Qu·∫£n l√Ω H·ª£p ƒë·ªìng</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>T√™n h·ª£p ƒë·ªìng</label>
                    <input type="text" id="contractName" placeholder="Nh·∫≠p t√™n h·ª£p ƒë·ªìng">
                </div>
                <div class="form-group">
                    <label>ƒê·ªëi t√°c</label>
                    <input type="text" id="contractPartner" placeholder="T√™n ƒë·ªëi t√°c">
                </div>
                <div class="form-group">
                    <label>Gi√° tr·ªã h·ª£p ƒë·ªìng</label>
                    <input type="number" id="contractValue" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Ng√†y b·∫Øt ƒë·∫ßu</label>
                    <input type="date" id="contractStartDate">
                </div>
                <div class="form-group">
                    <label>Ng√†y k·∫øt th√∫c</label>
                    <input type="date" id="contractEndDate">
                </div>
                <div class="form-group">
                    <label>Tr·∫°ng th√°i</label>
                    <select id="contractStatus">
                        <option value="active">ƒêang th·ª±c hi·ªán</option>
                        <option value="completed">Ho√†n th√†nh</option>
                        <option value="pending">Ch·ªù x·ª≠ l√Ω</option>
                        <option value="cancelled">ƒê√£ h·ªßy</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>M√¥ t·∫£</label>
                <textarea id="contractDescription" rows="3" placeholder="M√¥ t·∫£ chi ti·∫øt h·ª£p ƒë·ªìng"></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="addContract()">‚ûï Th√™m h·ª£p ƒë·ªìng</button>
            
            <table class="data-table" id="contractsTable">
                <thead>
                    <tr>
                        <th>T√™n h·ª£p ƒë·ªìng</th>
                        <th>ƒê·ªëi t√°c</th>
                        <th>Gi√° tr·ªã</th>
                        <th>B·∫Øt ƒë·∫ßu</th>
                        <th>K·∫øt th√∫c</th>
                        <th>Tr·∫°ng th√°i</th>
                        <th>Ti·∫øn ƒë·ªô</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="contractsTableBody">
                </tbody>
            </table>
        </div>

        <!-- Tab Doanh thu -->
        <div id="revenue" class="tab-content">
            <h2>üí∞ Qu·∫£n l√Ω Doanh thu</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>H·ª£p ƒë·ªìng li√™n quan</label>
                    <select id="revenueContract">
                        <option value="">Ch·ªçn h·ª£p ƒë·ªìng</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn</label>
                    <input type="number" id="revenueAmount" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Ng√†y thu</label>
                    <input type="date" id="revenueDate">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i doanh thu</label>
                    <select id="revenueType">
                        <option value="service">D·ªãch v·ª•</option>
                        <option value="product">S·∫£n ph·∫©m</option>
                        <option value="consulting">T∆∞ v·∫•n</option>
                        <option value="other">Kh√°c</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Ghi ch√∫</label>
                <textarea id="revenueNote" rows="2" placeholder="Ghi ch√∫ v·ªÅ kho·∫£n thu"></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="addRevenue()">‚ûï Th√™m doanh thu</button>
            
            <table class="data-table" id="revenueTable">
                <thead>
                    <tr>
                        <th>H·ª£p ƒë·ªìng</th>
                        <th>S·ªë ti·ªÅn</th>
                        <th>Ng√†y thu</th>
                        <th>Lo·∫°i</th>
                        <th>Ghi ch√∫</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="revenueTableBody">
                </tbody>
            </table>
        </div>

        <!-- Tab Chi ph√≠ -->
        <div id="expenses" class="tab-content">
            <h2>üí∏ Qu·∫£n l√Ω Chi ph√≠</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>H·ª£p ƒë·ªìng li√™n quan</label>
                    <select id="expenseContract">
                        <option value="">Ch·ªçn h·ª£p ƒë·ªìng</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>S·ªë ti·ªÅn</label>
                    <input type="number" id="expenseAmount" placeholder="0">
                </div>
                <div class="form-group">
                    <label>Ng√†y chi</label>
                    <input type="date" id="expenseDate">
                </div>
                <div class="form-group">
                    <label>Lo·∫°i chi ph√≠</label>
                    <select id="expenseType">
                        <option value="material">V·∫≠t li·ªáu</option>
                        <option value="labor">Nh√¢n c√¥ng</option>
                        <option value="transport">V·∫≠n chuy·ªÉn</option>
                        <option value="marketing">Marketing</option>
                        <option value="office">VƒÉn ph√≤ng</option>
                        <option value="other">Kh√°c</option>
                    </select>
                </div>
            </div>
            
            <div class="form-group">
                <label>Ghi ch√∫</label>
                <textarea id="expenseNote" rows="2" placeholder="Ghi ch√∫ v·ªÅ kho·∫£n chi"></textarea>
            </div>
            
            <button class="btn btn-primary" onclick="addExpense()">‚ûï Th√™m chi ph√≠</button>
            
            <table class="data-table" id="expenseTable">
                <thead>
                    <tr>
                        <th>H·ª£p ƒë·ªìng</th>
                        <th>S·ªë ti·ªÅn</th>
                        <th>Ng√†y chi</th>
                        <th>Lo·∫°i</th>
                        <th>Ghi ch√∫</th>
                        <th>Thao t√°c</th>
                    </tr>
                </thead>
                <tbody id="expenseTableBody">
                </tbody>
            </table>
        </div>

        <!-- Tab B√°o c√°o -->
        <div id="reports" class="tab-content">
            <h2>üìä B√°o c√°o T√†i ch√≠nh</h2>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Lo·∫°i b√°o c√°o</label>
                    <select id="reportType" onchange="generateReport()">
                        <option value="monthly">Theo th√°ng</option>
                        <option value="quarterly">Theo qu√Ω</option>
                        <option value="yearly">Theo nƒÉm</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Th·ªùi gian</label>
                    <input type="month" id="reportPeriod" onchange="generateReport()">
                </div>
            </div>
            
            <div class="stats-grid" id="reportStats">
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">0 ‚Ç´</div>
                    <div class="stat-label">T·ªïng doanh thu</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalExpenses">0 ‚Ç´</div>
                    <div class="stat-label">T·ªïng chi ph√≠</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="netProfit">0 ‚Ç´</div>
                    <div class="stat-label">L·ª£i nhu·∫≠n</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="taxPayable">0 ‚Ç´</div>
                    <div class="stat-label">Thu·∫ø ph·∫£i n·ªôp (20%)</div>
                </div>
            </div>
            
            <div id="reportDetails"></div>
        </div>

        <!-- Tab T·ªïng quan -->
        <div id="dashboard" class="tab-content">
            <h2>üéØ T·ªïng quan H·ªá th·ªëng</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalContracts">0</div>
                    <div class="stat-label">T·ªïng h·ª£p ƒë·ªìng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeContracts">0</div>
                    <div class="stat-label">ƒêang th·ª±c hi·ªán</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="monthlyRevenue">0 ‚Ç´</div>
                    <div class="stat-label">Doanh thu th√°ng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="monthlyProfit">0 ‚Ç´</div>
                    <div class="stat-label">L·ª£i nhu·∫≠n th√°ng</div>
                </div>
            </div>
            
            <h3>üìà H·ª£p ƒë·ªìng g·∫ßn ƒë√¢y</h3>
            <div id="recentContracts"></div>
            
            <h3>‚ö†Ô∏è H·ª£p ƒë·ªìng s·∫Øp h·∫øt h·∫°n</h3>
            <div id="expiringContracts"></div>
        </div>
    </div>

    <!-- Modal c·∫≠p nh·∫≠t ti·∫øn ƒë·ªô -->
    <div id="progressModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h3>C·∫≠p nh·∫≠t ti·∫øn ƒë·ªô h·ª£p ƒë·ªìng</h3>
            <div class="form-group">
                <label>Ti·∫øn ƒë·ªô (%)</label>
                <input type="range" id="progressSlider" min="0" max="100" value="0" oninput="updateProgressValue()">
                <span id="progressValue">0%</span>
            </div>
            <button class="btn btn-primary" onclick="saveProgress()">L∆∞u ti·∫øn ƒë·ªô</button>
        </div>
    </div>

    <script>
        // D·ªØ li·ªáu trong b·ªô nh·ªõ
        let contracts = [];
        let revenues = [];
        let expenses = [];
        let currentContractId = null;

        // Kh·ªüi t·∫°o
        document.addEventListener('DOMContentLoaded', function() {
            loadSampleData();
            updateDashboard();
            generateReport();
            document.getElementById('reportPeriod').value = new Date().toISOString().slice(0, 7);
        });

        // Chuy·ªÉn tab
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'reports') generateReport();
        }

        // Th√™m h·ª£p ƒë·ªìng
        function addContract() {
            const contract = {
                id: Date.now(),
                name: document.getElementById('contractName').value,
                partner: document.getElementById('contractPartner').value,
                value: parseFloat(document.getElementById('contractValue').value) || 0,
                startDate: document.getElementById('contractStartDate').value,
                endDate: document.getElementById('contractEndDate').value,
                status: document.getElementById('contractStatus').value,
                description: document.getElementById('contractDescription').value,
                progress: 0
            };

            if (!contract.name || !contract.partner) {
                alert('Vui l√≤ng nh·∫≠p t√™n h·ª£p ƒë·ªìng v√† ƒë·ªëi t√°c!');
                return;
            }

            contracts.push(contract);
            updateContractTable();
            updateContractSelects();
            clearContractForm();
            updateDashboard();
        }

        // C·∫≠p nh·∫≠t b·∫£ng h·ª£p ƒë·ªìng
        function updateContractTable() {
            const tbody = document.getElementById('contractsTableBody');
            tbody.innerHTML = '';
            
            contracts.forEach(contract => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td><strong>${contract.name}</strong></td>
                    <td>${contract.partner}</td>
                    <td>${formatCurrency(contract.value)}</td>
                    <td>${formatDate(contract.startDate)}</td>
                    <td>${formatDate(contract.endDate)}</td>
                    <td><span class="status-badge status-${contract.status}">${getStatusText(contract.status)}</span></td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${contract.progress}%"></div>
                        </div>
                        <small>${contract.progress}%</small>
                    </td>
                    <td>
                        <button class="btn btn-success" onclick="openProgressModal(${contract.id})" style="margin-right: 5px; padding: 5px 10px;">üìà</button>
                        <button class="btn btn-danger" onclick="deleteContract(${contract.id})" style="padding: 5px 10px;">üóëÔ∏è</button>
                    </td>
                `;
            });
        }

        // C·∫≠p nh·∫≠t dropdown h·ª£p ƒë·ªìng
        function updateContractSelects() {
            const selects = ['revenueContract', 'expenseContract'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                select.innerHTML = '<option value="">Ch·ªçn h·ª£p ƒë·ªìng</option>';
                contracts.forEach(contract => {
                    select.innerHTML += `<option value="${contract.id}">${contract.name} - ${contract.partner}</option>`;
                });
            });
        }

        // Th√™m doanh thu
        function addRevenue() {
            const revenue = {
                id: Date.now(),
                contractId: document.getElementById('revenueContract').value,
                amount: parseFloat(document.getElementById('revenueAmount').value) || 0,
                date: document.getElementById('revenueDate').value,
                type: document.getElementById('revenueType').value,
                note: document.getElementById('revenueNote').value
            };

            if (revenue.amount <= 0) {
                alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!');
                return;
            }

            revenues.push(revenue);
            updateRevenueTable();
            clearRevenueForm();
            updateDashboard();
        }

        // C·∫≠p nh·∫≠t b·∫£ng doanh thu
        function updateRevenueTable() {
            const tbody = document.getElementById('revenueTableBody');
            tbody.innerHTML = '';
            
            revenues.forEach(revenue => {
                const contract = contracts.find(c => c.id == revenue.contractId);
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${contract ? contract.name : 'Kh√¥ng x√°c ƒë·ªãnh'}</td>
                    <td><strong>${formatCurrency(revenue.amount)}</strong></td>
                    <td>${formatDate(revenue.date)}</td>
                    <td>${getRevenueTypeText(revenue.type)}</td>
                    <td>${revenue.note}</td>
                    <td><button class="btn btn-danger" onclick="deleteRevenue(${revenue.id})" style="padding: 5px 10px;">üóëÔ∏è</button></td>
                `;
            });
        }

        // Th√™m chi ph√≠
        function addExpense() {
            const expense = {
                id: Date.now(),
                contractId: document.getElementById('expenseContract').value,
                amount: parseFloat(document.getElementById('expenseAmount').value) || 0,
                date: document.getElementById('expenseDate').value,
                type: document.getElementById('expenseType').value,
                note: document.getElementById('expenseNote').value
            };

            if (expense.amount <= 0) {
                alert('Vui l√≤ng nh·∫≠p s·ªë ti·ªÅn h·ª£p l·ªá!');
                return;
            }

            expenses.push(expense);
            updateExpenseTable();
            clearExpenseForm();
            updateDashboard();
        }

        // C·∫≠p nh·∫≠t b·∫£ng chi ph√≠
        function updateExpenseTable() {
            const tbody = document.getElementById('expenseTableBody');
            tbody.innerHTML = '';
            
            expenses.forEach(expense => {
                const contract = contracts.find(c => c.id == expense.contractId);
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${contract ? contract.name : 'Kh√¥ng x√°c ƒë·ªãnh'}</td>
                    <td><strong>${formatCurrency(expense.amount)}</strong></td>
                    <td>${formatDate(expense.date)}</td>
                    <td>${getExpenseTypeText(expense.type)}</td>
                    <td>${expense.note}</td>
                    <td><button class="btn btn-danger" onclick="deleteExpense(${expense.id})" style="padding: 5px 10px;">üóëÔ∏è</button></td>
                `;
            });
        }

        // T·∫°o b√°o c√°o
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const period = document.getElementById('reportPeriod').value;
            
            if (!period) return;
            
            let startDate, endDate;
            const [year, month] = period.split('-');
            
            if (reportType === 'monthly') {
                startDate = new Date(year, month - 1, 1);
                endDate = new Date(year, month, 0);
            } else if (reportType === 'quarterly') {
                const quarter = Math.ceil(month / 3);
                startDate = new Date(year, (quarter - 1) * 3, 1);
                endDate = new Date(year, quarter * 3, 0);
            } else {
                startDate = new Date(year, 0, 1);
                endDate = new Date(year, 11, 31);
            }

            const periodRevenues = revenues.filter(r => {
                const date = new Date(r.date);
                return date >= startDate && date <= endDate;
            });

            const periodExpenses = expenses.filter(e => {
                const date = new Date(e.date);
                return date >= startDate && date <= endDate;
            });

            const totalRevenue = periodRevenues.reduce((sum, r) => sum + r.amount, 0);
            const totalExpenses = periodExpenses.reduce((sum, e) => sum + e.amount, 0);
            const netProfit = totalRevenue - totalExpenses;
            const taxPayable = netProfit > 0 ? netProfit * 0.2 : 0;

            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('totalExpenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('netProfit').textContent = formatCurrency(netProfit);
            document.getElementById('taxPayable').textContent = formatCurrency(taxPayable);
        }

        // C·∫≠p nh·∫≠t dashboard
        function updateDashboard() {
            const currentMonth = new Date().toISOString().slice(0, 7);
            const [year, month] = currentMonth.split('-');
            const startDate = new Date(year, month - 1, 1);
            const endDate = new Date(year, month, 0);

            const monthlyRevenues = revenues.filter(r => {
                const date = new Date(r.date);
                return date >= startDate && date <= endDate;
            });

            const monthlyExpenses = expenses.filter(e => {
                const date = new Date(e.date);
                return date >= startDate && date <= endDate;
            });

            const monthlyRevenueTotal = monthlyRevenues.reduce((sum, r) => sum + r.amount, 0);
            const monthlyExpenseTotal = monthlyExpenses.reduce((sum, e) => sum + e.amount, 0);
            const monthlyProfitTotal = monthlyRevenueTotal - monthlyExpenseTotal;

            document.getElementById('totalContracts').textContent = contracts.length;
            document.getElementById('activeContracts').textContent = contracts.filter(c => c.status === 'active').length;
            document.getElementById('monthlyRevenue').textContent = formatCurrency(monthlyRevenueTotal);
            document.getElementById('monthlyProfit').textContent = formatCurrency(monthlyProfitTotal);

            // H·ª£p ƒë·ªìng g·∫ßn ƒë√¢y
            const recentContracts = contracts.slice(-3).reverse();
            const recentDiv = document.getElementById('recentContracts');
            recentDiv.innerHTML = '';
            recentContracts.forEach(contract => {
                recentDiv.innerHTML += `
                    <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 4px solid #667eea;">
                        <strong>${contract.name}</strong> - ${contract.partner}<br>
                        <small>Gi√° tr·ªã: ${formatCurrency(contract.value)} | Tr·∫°ng th√°i: ${getStatusText(contract.status)}</small>
                    </div>
                `;
            });

            // H·ª£p ƒë·ªìng s·∫Øp h·∫øt h·∫°n
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            const expiringContracts = contracts.filter(c => {
                const endDate = new Date(c.endDate);
                return endDate >= today && endDate <= nextWeek && c.status === 'active';
            });

            const expiringDiv = document.getElementById('expiringContracts');
            expiringDiv.innerHTML = '';
            if (expiringContracts.length === 0) {
                expiringDiv.innerHTML = '<p style="color: #666;">Kh√¥ng c√≥ h·ª£p ƒë·ªìng n√†o s·∫Øp h·∫øt h·∫°n.</p>';
            } else {
                expiringContracts.forEach(contract => {
                    expiringDiv.innerHTML += `
                        <div style="background: #fff3cd; padding: 15px; margin: 10px 0; border-radius: 10px; border-left: 4px solid #ffc107;">
                            <strong>${contract.name}</strong> - ${contract.partner}<br>
                            <small>H·∫øt h·∫°n: ${formatDate(contract.endDate)} | Gi√° tr·ªã: ${formatCurrency(contract.value)}</small>
                        </div>
                    `;
                });
            }
        }

        // Modal ti·∫øn ƒë·ªô
        function openProgressModal(contractId) {
            currentContractId = contractId;
            const contract = contracts.find(c => c.id === contractId);
            document.getElementById('progressSlider').value = contract.progress;
            document.getElementById('progressValue').textContent = contract.progress + '%';
            document.getElementById('progressModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('progressModal').style.display = 'none';
        }

        function updateProgressValue() {
            const value = document.getElementById('progressSlider').value;
            document.getElementById('progressValue').textContent = value + '%';
        }

        function saveProgress() {
            const progress = parseInt(document.getElementById('progressSlider').value);
            const contract = contracts.find(c => c.id === currentContractId);
            contract.progress = progress;
            
            if (progress === 100 && contract.status === 'active') {
                contract.status = 'completed';
            }
            
            updateContractTable();
            closeModal();
            updateDashboard();
        }

        // X√≥a d·ªØ li·ªáu
        function deleteContract(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a h·ª£p ƒë·ªìng n√†y?')) {
                contracts = contracts.filter(c => c.id !== id);
                updateContractTable();
                updateContractSelects();
                updateDashboard();
            }
        }

        function deleteRevenue(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kho·∫£n doanh thu n√†y?')) {
                revenues = revenues.filter(r => r.id !== id);
                updateRevenueTable();
                updateDashboard();
            }
        }

        function deleteExpense(id) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a kho·∫£n chi ph√≠ n√†y?')) {
                expenses = expenses.filter(e => e.id !== id);
                updateExpenseTable();
                updateDashboard();
            }
        }

        // X√≥a form
        function clearContractForm() {
            document.getElementById('contractName').value = '';
            document.getElementById('contractPartner').value = '';
            document.getElementById('contractValue').value = '';
            document.getElementById('contractStartDate').value = '';
            document.getElementById('contractEndDate').value = '';
            document.getElementById('contractStatus').value = 'active';
            document.getElementById('contractDescription').value = '';
        }

        function clearRevenueForm() {
            document.getElementById('revenueContract').value = '';
            document.getElementById('revenueAmount').value = '';
            document.getElementById('revenueDate').value = '';
            document.getElementById('revenueType').value = 'service';
            document.getElementById('revenueNote').value = '';
        }

        function clearExpenseForm() {
            document.getElementById('expenseContract').value = '';
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDate').value = '';
            document.getElementById('expenseType').value = 'material';
            document.getElementById('expenseNote').value = '';
        }

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        function formatDate(dateString) {
            if (!dateString) return '';
            return new Date(dateString).toLocaleDateString('vi-VN');
        }

        function getStatusText(status) {
            const statusMap = {
                'active': 'ƒêang th·ª±c hi·ªán',
                'completed': 'Ho√†n th√†nh',
                'pending': 'Ch·ªù x·ª≠ l√Ω',
                'cancelled': 'ƒê√£ h·ªßy'
            };
            return statusMap[status] || status;
        }

        function getRevenueTypeText(type) {
            const typeMap = {
                'service': 'D·ªãch v·ª•',
                'product': 'S·∫£n ph·∫©m',
                'consulting': 'T∆∞ v·∫•n',
                'other': 'Kh√°c'
            };
            return typeMap[type] || type;
        }

        function getExpenseTypeText(type) {
            const typeMap = {
                'material': 'V·∫≠t li·ªáu',
                'labor': 'Nh√¢n c√¥ng',
                'transport': 'V·∫≠n chuy·ªÉn',
                'marketing': 'Marketing',
                'office': 'VƒÉn ph√≤ng',
                'other': 'Kh√°c'
            };
            return typeMap[type] || type;
        }

        // D·ªØ li·ªáu m·∫´u
        function loadSampleData() {
            contracts = [
                {
                    id: 1,
                    name: 'Ph√°t tri·ªÉn Website ABC Corp',
                    partner: 'ABC Corporation',
                    value: 50000000,
                    startDate: '2024-01-15',
                    endDate: '2024-06-15',
                    status: 'active',
                    description: 'Ph√°t tri·ªÉn website th∆∞∆°ng m·∫°i ƒëi·ªán t·ª≠',
                    progress: 65
                },
                {
                    id: 2,
                    name: 'T∆∞ v·∫•n IT cho XYZ Ltd',
                    partner: 'XYZ Limited',
                    value: 30000000,
                    startDate: '2024-02-01',
                    endDate: '2024-12-31',
                    status: 'active',
                    description: 'T∆∞ v·∫•n h·ªá th·ªëng th√¥ng tin',
                    progress: 30
                }
            ];

            revenues = [
                {
                    id: 1,
                    contractId: 1,
                    amount: 25000000,
                    date: '2024-03-01',
                    type: 'service',
                    note: 'Thanh to√°n ƒë·ª£t 1'
                },
                {
                    id: 2,
                    contractId: 2,
                    amount: 15000000,
                    date: '2024-04-01',
                    type: 'consulting',
                    note: 'Thanh to√°n qu√Ω 1'
                }
            ];

            expenses = [
                {
                    id: 1,
                    contractId: 1,
                    amount: 8000000,
                    date: '2024-02-15',
                    type: 'labor',
                    note: 'Chi ph√≠ nh√¢n c√¥ng th√°ng 2'
                },
                {
                    id: 2,
                    contractId: 1,
                    amount: 2000000,
                    date: '2024-03-01',
                    type: 'material',
                    note: 'Mua m√°y ch·ªß'
                }
            ];

            updateContractTable();
            updateContractSelects();
            updateRevenueTable();
            updateExpenseTable();
        }

        // ƒê√≥ng modal khi click b√™n ngo√†i
        window.onclick = function(event) {
            const modal = document.getElementById('progressModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>